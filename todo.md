# 專案任務清單

## 已完成 ✅

### 開發環境啟動腳本
- [x] 建立 start_dev.sh 腳本
- [x] 實作 API 服務啟動 (端口 8080)
- [x] 實作 Android 模擬器啟動
- [x] 實作 Flutter 應用啟動
- [x] 實作端口衝突處理
- [x] 實作進程清理機制
- [x] 實作虛擬環境檢測和自動建立
- [x] 實作錯誤處理和狀態檢查
- [x] 實作 Pixel 9 Pro XL 模擬器優先啟動
- [x] 建立測試腳本和說明文件

### UI/UX 改進
- [x] 修復 Flutter 應用編譯錯誤
- [x] 移除頂部標題區塊
- [x] 修復圖片顯示問題（懶加載支援）
- [x] 修復 API 服務依賴問題（移除 lxml）
- [x] 優化爬蟲速度（減少延遲到 0.1 秒）
- [x] 修復列表縮圖被裁切問題
- [x] 修復橫式顯示彈出視窗超出邊界問題
- [x] 啟用 API 和 Android 模擬器熱加載
- [x] 修復語法錯誤（video_preview_dialog.dart）
- [x] 修復 video_preview_dialog.dart 中 BoxDecoration 缺少右括號的語法錯誤
- [x] 優化列表項目佈局（減少圖片和文字間距）
- [x] 簡化彈出視窗內容（只顯示圖片、標題、按鈕）
- [x] 改善播放按鈕載入狀態（載入中顯示 loading，錯誤時禁用）
- [x] 修復彈出視窗佈局溢出問題
- [x] 修復列表圖片被裁切問題（改回 BoxFit.contain）
- [x] 減少圖片和文字間距（調整圖片區域比例為 6:1，減少文字 padding）
- [x] 優化圖片佈局（寬度適應 grid，高度根據 16:9 比例自動調整）
- [x] 修復熱加載問題（移除已棄用的 --hot 參數）
- [x] 優化卡片高度（讓單一物件高度自動遷就內容）
- [x] 減少物件間空白間距（調整寬高比和 padding）
- [x] 實現內容自適應高度（使用 IntrinsicHeight 和 SliverGridDelegateWithMaxCrossAxisExtent）
- [x] 改用 ListView + Row 佈局實現真正的內容自適應高度
- [x] 修復 IntrinsicHeight 佈局錯誤（移除 IntrinsicHeight 避免與 Row 衝突）
- [x] 優化彈出視窗佈局（圖片完整呈現，標題完整顯示，自動適應畫面）
- [x] 移除播放器標題覆蓋層（播放時不顯示檔案標題）
- [x] 添加完整的 TV 遙控器支援（所有操作都支援遙控器控制）
- [x] 優化彈出視窗橫版佈局（圖片左側，標題和按鈕右側，自動適應畫面）
- [x] 添加播放器遙控器方向鍵支援（上下控制音量，左右控制快進快退，OK鍵控制播放暫停，back返回）
- [x] 修正播放器遙控器按鍵映射（上下鍵對調，左右鍵對調）
- [x] 添加播放器暫停時控制介面（顯示播放按鈕和提示）
- [x] 優化播放器滿版顯示
- [x] 移除多餘的音量指示器
- [x] 修正遙控器按鍵映射（上下控制音量，左右控制播放進度）
- [x] 添加觸控手勢支援（上下滑動控制音量，左右滑動控制播放進度）
- [x] 讓 OK 鍵動作與點擊畫面共通
- [x] 實現真正的滿版播放（移除系統工具列）
- [x] 統一手機和遙控器控制邏輯（暫停時顯示推薦影片，左右鍵選擇，OK鍵確認）
- [x] 修正手機點擊直接進入暫停狀態（移除中間控制器流程）
- [x] 修復推薦影片載入功能（放寬顯示條件，添加載入提示）
- [x] 修復 API 演員影片功能（添加分頁參數支援）
- [x] 實現完整的 back 鍵管理系統（導航歷史追蹤，退出確認對話框）
- [x] 修正首頁退出確認邏輯（取消後再次按 back 直接退出）
- [x] 修正退出確認邏輯（必須按確定按鈕才能退出，不能直接退出）
- [x] 實現推薦影片列表自動滾動（選擇框始終保持在畫面內）
- [x] 修正遙控器按鍵行為（左右鍵只負責選擇，上下鍵只負責音量，不觸發暫停按鈕）
- [x] 修正API演員名稱獲取（從演員頁面獲取完整名稱而非影片頁面）
- [x] 修正播放時左右鍵不顯示作品列表（只有用戶主動暫停時才顯示）

### Jable.tv 爬蟲 API 專案建構
- [x] 建立專案基本結構
- [x] 設定 Python 依賴 (requirements.txt)
- [x] 設定開發依賴 (requirements-dev.txt)
- [x] 建立環境變數範例 (env.example)
- [x] 建立 Git 忽略檔案 (.gitignore)
- [x] 建立應用程式配置 (app/config.py)
- [x] 建立 Jable.tv 專用爬蟲 (app/core/scraper.py)
- [x] 建立 Pydantic 模型 (app/schemas/scraper.py)
- [x] 建立 API 端點 (app/api/v1/endpoints/scraper.py)
- [x] 建立 API 路由整合 (app/api/v1/api.py)
- [x] 建立主應用程式 (app/main.py)
- [x] 建立輔助工具函數 (app/utils/helpers.py)
- [x] 建立測試檔案 (tests/test_scraper.py)
- [x] 建立 Docker 配置 (Dockerfile, docker-compose.yml)
- [x] 建立專案說明 (README.md)

### 核心功能實作
- [x] 中文影片列表爬取 (支援分頁)
- [x] 影片詳情和播放資訊提取
- [x] 演員相關影片查詢
- [x] HTML 解析和資料提取
- [x] 影片編號提取 (如 pppe-356)
- [x] 播放連結和金鑰提取

## 待完成 🔄

### 功能優化
- [ ] 實作請求重試機制
- [ ] 新增代理支援
- [ ] 優化 HTML 解析邏輯
- [ ] 新增更多錯誤處理
- [ ] 實作結果快取機制

### 測試與品質
- [ ] 執行實際網站測試
- [ ] 新增更多測試案例
- [ ] 設定程式碼品質檢查
- [ ] 設定 CI/CD 流程

### 部署與監控
- [ ] 設定詳細日誌記錄
- [ ] 新增監控端點
- [ ] 優化效能和記憶體使用
- [ ] 新增健康檢查機制

### 文件與維護
- [ ] 完善 API 文件
- [ ] 新增更多使用範例
- [ ] 建立部署指南
- [ ] 新增故障排除指南

### GCP Cloud Build 自動部署
- [x] 創建專案根目錄 Dockerfile
- [x] 創建 cloudbuild.yaml 配置文件
- [x] 創建 .dockerignore 文件
- [x] 創建 GCP 設定指南 (GCP_SETUP.md)
- [x] 移除不需要的 GitHub Actions 和手動部署腳本
- [ ] 設定 Google Cloud 專案和 API 啟用
- [ ] 在 GCP Console 設定 Cloud Build 觸發器
- [ ] 連接 GitHub 倉庫到 Cloud Build
- [ ] 設定 Cloud Build 服務帳戶權限
- [ ] 測試自動化部署流程（推送到 main 分支）
- [ ] 更新 Flutter 應用中的 API 基礎 URL 配置
- [ ] 設定監控和日誌收集

## 技術細節

### HTML 解析目標
- 影片列表頁面: `https://jable.tv/categories/chinese-subtitle/`
- 影片詳情頁面: `https://jable.tv/videos/{video_id}/`
- 演員頁面: 從影片詳情頁面提取的演員連結

### 提取資料項目
- 影片標題、圖片、連結、編號、時長
- 影片描述、發布日期、演員資訊
- 播放連結和金鑰
- 演員相關影片列表

## 注意事項

- 確保在 .venv 虛擬環境中運行
- 遵循 Python 編碼規範
- 定期更新依賴套件
- 保持程式碼品質和測試覆蓋率
- 遵守網站使用條款和爬蟲規範
- 設定適當的請求延遲避免對伺服器造成負擔
